<?php
    $blankPage = isset($this->layout()->blankPage) ? $this->layout()->blankPage : $this->blankPage;
    $needLeft  = isset($this->layout()->needLeft)  ? $this->layout()->needLeft  : $this->needLeft;
    $needRight = isset($this->layout()->needRight) ? $this->layout()->needRight : $this->needRight;

    $moderMenu = '';
    if (!$blankPage && $this->user()->logedIn() && $this->acl()->inheritsRole($this->user()->get()->role, 'moder')) {
        $moderMenu = $this->action('moder-menu', 'index', 'moder');
    }

    $mainMenu = '';
    if (!$blankPage) {
        $mainMenu = $this->action('main-menu', 'pages', 'default');
    }

    if ($this->jQuery()->uiIsEnabled()) {
        $this->headLink()->appendStylesheet('/js/libs/jquery/ui/theme/ui.all.css');
    }
?>
<?=$this->doctype() . PHP_EOL ?>
<html dir="ltr" lang="<?=$this->language()->get()?>">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php
            echo $this->headMeta();
            echo $this->headTitle();
            echo $this->headLink(array('rel' => 'shortcut icon', 'href' => '/favicon.ico', 'type' => 'image/x-icon'), 'PREPEND');

            //echo $this->stylesheets();
            echo $this->jQuery();
            echo $this->headScript()
                ->appendFile(
                    'http://html5shim.googlecode.com/svn/trunk/html5.js',
                    'text/javascript',
                    array('conditional' => 'lt IE 9')
                )
                ->appendFile(
                    '/vendor/scottjehl/Respond/respond.min.js',
                    'text/javascript',
                    array('conditional' => 'lt IE 9')
                );
            echo $this->headStyle();
        ?>
    </head>
    <body>
        <?=$moderMenu ?>

        <?php
            $spanLeft = $needLeft ? 4 : 0;
            $spanRight = $needRight ? 4 : 0;
            $spanCenter = 12 - $spanLeft - $spanRight;
        ?>

        <?php if (!$blankPage) { ?>
            <?=$mainMenu ?>
        <?php }  ?>

        <div class="container">
            <div class="row">

                <div class="col-lg-<?=$spanCenter?> col-push-<?=$spanLeft?>">
                    <?php if (isset($this->flashMessages) && $this->flashMessages) { ?>
                        <?php foreach($this->flashMessages as $message) { ?>
                            <div class="alert alert-info">
                                <?=$message ?>
                            </div>
                        <?php } ?>
                    <?php } ?>

                    <?=$this->breadcrumbs() ?>
                    <?=$this->pageTitle() ?>

                    <?=$this->layout()->content ?>

                </div>

                <?php if ($needLeft) { ?>
                    <div class="col-lg-<?=$spanLeft?> col-pull-<?=$spanCenter?>">
                        <?=$this->layout()->sidebar ?>
                    </div>
                <?php } ?>

                <?php if ($needRight) { ?>
                    <div class="col-lg-<?=$spanRight?>">

                        <h3>Авторизация</h3>
                        <div class="well">
                            <?php if ($this->user()->logedIn()) { ?>
                                <div>
                                    Здравствуйте, <?=$this->user() ?><br />
                                    <a href="/account/profile/">Личная&#xa0;страница</a><br />
                                    <a href="/login/logout/">Выход</a>
                                </div>

                                <?php
                                    $db = Zend_Registry::get('db');
                                    $count = $db->fetchOne(
                                        $db->select()
                                           ->from('personal_messages', array('COUNT(1)'))
                                           ->where('to_user_id = ?', $this->user()->get()->id)
                                           ->where('NOT readen')
                                    );
                                ?>

                                <p>
                                    <span class="glyphicon glyphicon-comment"></span>
                                    <?php if ($count > 0) { ?>
                                        <a href="/account/pm/" style="color:red">У вас <?=$count?> <?=numericDeclension($count, 'новое сообщение', 'новых сообщения', 'новых сообщений')?></a>
                                    <?php } else { ?>
                                        <a href="/account/pm/">Личные сообщения</a>
                                    <?php } ?>
                                </p>
                            <?php } else { ?>
                                <form action="/login/" method="post" class="login"><div>
                                    <p><input type="text" name="login" placeholder="Логин или e-mail" /></p>
                                    <p><input type="password" name="password" placeholder="Пароль" /></p>
                                    <label class="checkbox inline">
                                        <input type="checkbox" value="1" name="remember" /> запомнить?
                                    </label>
                                    <div>
                                        <div class="pull-right text-right">
                                            <a href="/registration/">Регистрация</a><br />
                                            <a href="/restorepassword/">Забыли пароль?</a>
                                        </div>
                                        <input type="submit" value="войти" class="btn btn-primary" />
                                    </div>
                                </div></form>
                            <?php } ?>
                        </div>

                        <a class="twitter-timeline"  href="https://twitter.com/autowp_ru"  data-widget-id="323907714319253505" data-chrome="nofooter" width="370">Твиты пользователя @autowp_ru</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                    </div>
                <?php } ?>
            </div>

            <?php if ((!$blankPage) && (!$this->isAdminPage) ) { ?>
                <div class="bottom-line"><p><strong>AutoWP.ru '2005&ndash;<?=$this->escape($this->translate('present-time-abbr'))?></strong></p></div>

                <footer class="footer">
                    <div class="row">
                        <div class="col-lg-6">
                            <?=$this->htmlA(
                                'http://www.liveinternet.ru/click',
                                $this->htmlImg(array(
                                    'src'   => 'http://counter.yadro.ru/hit?t16.11;r' . urlencode(isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '') . ';' . rand(),
                                    'alt'   => 'liveinternet.ru',
                                    'title' => 'liveinternet.ru'
                                )),
                                false
                            )?>
<?php $this->inlineScript()->captureStart() ?>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24654784-1']);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
<?php $this->inlineScript()->captureEnd() ?>
<?=$this->inlineScript() ?>
                        </div>
                        <div class="col-lg-6">
                            <p class="copyrights">
                                Обращаем Ваше внимание на то, что все материалы, размещенные на сервере autowp.ru, добавлены посетителями сайта.<br />
                                Администрация сайта не располагает информацией о правомерности публикования этих материалов.<br />
                                Все изображения размещены в ознакомительных целях.<br />
                                <a href="mailto:autowp@yandex.ru">Сообщить о нарушении авторских прав</a>.
                            </p>
                        </div>
                    </div>
                </footer>
            <?php } ?>
        </div>
    </body>
</html>